package pe.gob.mininter.dirandro.vaadin.panel.util;

import java.util.List;

import pe.gob.mininter.dirandro.model.Dependencia;
import pe.gob.mininter.dirandro.service.DependenciaService;
import pe.gob.mininter.dirandro.vaadin.util.Injector;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Item;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.data.util.BeanItemContainer;
import com.vaadin.data.util.IndexedContainer;
import com.vaadin.ui.AbstractSelect.Filtering;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Table;
import com.vaadin.ui.VerticalLayout;

public class DependenciaComponent extends CustomComponent{

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_1;
	@AutoGenerated
	private Table table_1;
	@AutoGenerated
	private VerticalLayout verticalLayout_2;
	@AutoGenerated
	private ComboBox cmbNivel7;
	@AutoGenerated
	private ComboBox cmbNivel6;
	@AutoGenerated
	private ComboBox cmbNivel5;
	@AutoGenerated
	private ComboBox cmbNivel4;
	@AutoGenerated
	private ComboBox cmbNivel3;
	@AutoGenerated
	private ComboBox cmbNivel2;
	@AutoGenerated
	private ComboBox cmbNivel1;
	/**
	 * 
	 */
	private static final long serialVersionUID = 7752848126228772872L;
	/**
	 * The constructor should first build the main layout, set the
	 * composition root and then do any custom initialization.
	 *
	 * The constructor will not be automatically regenerated by the
	 * visual editor.
	 */
	
	private DependenciaService dependenciaService;
	private List<Dependencia> listaNivel1,listaNivel2,listaNivel3,listaNivel4,listaNivel5,listaNivel6,listaNivel7;
	private Dependencia dependencia;
		
	public DependenciaComponent() {
		buildMainLayout();
		setCompositionRoot(mainLayout);
		dependenciaService = Injector.obtenerServicio(DependenciaService.class);
		postConstruct();
	}

	public Dependencia getDependencia() {
		return dependencia;
	}

	public void setDependencia(Dependencia dependencia) {
		this.dependencia = dependencia;
	}

	public void postConstruct() {

		listaNivel1 = dependenciaService.buscarPadres();
		llenaTabla(listaNivel1);
		cmbNivel1.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class,  listaNivel1));
		cmbNivel1.setImmediate(true);
		cmbNivel1.setItemCaptionPropertyId("nombre");
		cmbNivel1.setInputPrompt("Primer Nivel");
		cmbNivel1.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = 1326936703979463582L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				cargarNivel2(event);
			}
		});

		table_1.setSelectable(true);
		table_1.setImmediate(true);
		table_1.setNullSelectionAllowed(true);
		table_1.setNullSelectionItemId(null);
		table_1.addListener(new ValueChangeListener() {
			
			private static final long serialVersionUID = 7962790507398071986L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				boolean esModoNuevo = table_1.getValue() == null;
				if(esModoNuevo){
					table_1.setValue(null);
				}else{
					//Item item = table_1.getItem(table_1.getValue());
					//TODO: cargar los combos para el editar
				}
			}
		});	
		
	}
	
	private void cargarNivel2(ValueChangeEvent event){
		listaNivel2 = dependenciaService.buscarHijos((Dependencia) cmbNivel1.getValue());
		llenaTabla(listaNivel2);
		cmbNivel2.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class, listaNivel2));
		cmbNivel2.setItemCaptionPropertyId("nombre");
		cmbNivel2.setInputPrompt("Segundo Nivel");
		cmbNivel2.setFilteringMode(Filtering.FILTERINGMODE_CONTAINS);
		cmbNivel2.setImmediate(true);
		cmbNivel2.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = -2097195241870938605L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				cargarNivel3(event);
			}
		});
	}
	
	private void cargarNivel3(ValueChangeEvent event){
		listaNivel3 = dependenciaService.buscarHijos((Dependencia) cmbNivel2.getValue());
		llenaTabla(listaNivel3);
		cmbNivel3.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class, listaNivel3));
		cmbNivel3.setItemCaptionPropertyId("nombre");
		cmbNivel3.setInputPrompt("Tercer Nivel");
		cmbNivel3.setFilteringMode(Filtering.FILTERINGMODE_CONTAINS);
		cmbNivel3.setImmediate(true);
		cmbNivel3.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = -2097195241870938605L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				cargarNivel4(event);
			}
		});
	}
	
	private void cargarNivel4(ValueChangeEvent event){
		listaNivel4 = dependenciaService.buscarHijos((Dependencia) cmbNivel3.getValue());
		llenaTabla(listaNivel4);
		cmbNivel4.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class, listaNivel4));
		cmbNivel4.setItemCaptionPropertyId("nombre");
		cmbNivel4.setInputPrompt("Cuarto Nivel");
		cmbNivel4.setFilteringMode(Filtering.FILTERINGMODE_CONTAINS);
		cmbNivel4.setImmediate(true);
		cmbNivel4.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = -2097195241870938605L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				cargarNivel5(event);
			}
		});
	}
	
	private void cargarNivel5(ValueChangeEvent event){
		listaNivel5 = dependenciaService.buscarHijos((Dependencia) cmbNivel4.getValue());
		llenaTabla(listaNivel5);
		cmbNivel5.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class, listaNivel5));
		cmbNivel5.setItemCaptionPropertyId("nombre");
		cmbNivel5.setInputPrompt("Quinto Nivel");
		cmbNivel5.setFilteringMode(Filtering.FILTERINGMODE_CONTAINS);
		cmbNivel5.setImmediate(true);
		cmbNivel5.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = -2097195241870938605L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				cargarNivel6(event);
			}
		});
	}
	
	private void cargarNivel6(ValueChangeEvent event){
		listaNivel6 = dependenciaService.buscarHijos((Dependencia) cmbNivel5.getValue());
		llenaTabla(listaNivel6);
		cmbNivel6.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class, listaNivel6));
		cmbNivel6.setItemCaptionPropertyId("nombre");
		cmbNivel6.setInputPrompt("Sexo Nivel");
		cmbNivel6.setFilteringMode(Filtering.FILTERINGMODE_CONTAINS);
		cmbNivel6.setImmediate(true);
		cmbNivel6.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = -2097195241870938605L;

			@Override
			public void valueChange(ValueChangeEvent event) {
				cargarNivel7(event);
			}
		});
	}
	
	private void cargarNivel7(ValueChangeEvent event){
		listaNivel7 = dependenciaService.buscarHijos((Dependencia) cmbNivel6.getValue());
		llenaTabla(listaNivel7);
		cmbNivel7.setContainerDataSource(new BeanItemContainer<Dependencia>(Dependencia.class, listaNivel7));
		cmbNivel7.setItemCaptionPropertyId("nombre");
		cmbNivel7.setInputPrompt("Septimo Nivel");
	}
	
	public void llenaTabla( List<Dependencia> lista){

		IndexedContainer container = new IndexedContainer();
		container.addContainerProperty("id", Long.class,  null);
		container.addContainerProperty("nombre", String.class, null);
		container.addContainerProperty("seleccionar", Button.class, null);
		
		table_1.setContainerDataSource(container);
		table_1.setVisibleColumns(new Object[]{"seleccionar","nombre"});

		table_1.setColumnHeader("nombre", "Dependencia");
		table_1.setColumnHeader("seleccionar", "Seleccionar");
		
		int con=1;
		for (Dependencia detarma : lista){
			
			Item item = container.addItem(con++);
			item.getItemProperty("id").setValue(detarma.getId());
			item.getItemProperty("nombre").setValue(detarma.getNombre());
			
			Button detailsField = new Button("Seleccionar");
		    detailsField.setData(detarma);
		    detailsField.addListener(new ClickListener() {
				private static final long serialVersionUID = 5141713121939621261L;

				public void buttonClick(ClickEvent event) {
		         	setDependencia((Dependencia)event.getButton().getData());
					detach();
		            getApplication().getMainWindow().removeWindow(getWindow());
		        } 
		    });
			item.getItemProperty("seleccionar").setValue(detailsField);
		}
	
	}
	
	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");
		mainLayout.setMargin(false);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");
		
		// horizontalLayout_1
		horizontalLayout_1 = buildHorizontalLayout_1();
		mainLayout.addComponent(horizontalLayout_1);
		
		return mainLayout;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_1() {
		// common part: create layout
		horizontalLayout_1 = new HorizontalLayout();
		horizontalLayout_1.setImmediate(false);
		horizontalLayout_1.setWidth("-1px");
		horizontalLayout_1.setHeight("-1px");
		horizontalLayout_1.setMargin(false);
		horizontalLayout_1.setSpacing(true);
		
		// verticalLayout_2
		verticalLayout_2 = buildVerticalLayout_2();
		horizontalLayout_1.addComponent(verticalLayout_2);
		
		// table_1
		table_1 = new Table();
		table_1.setImmediate(false);
		table_1.setWidth("400px");
		table_1.setHeight("267px");
		horizontalLayout_1.addComponent(table_1);
		
		return horizontalLayout_1;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_2() {
		// common part: create layout
		verticalLayout_2 = new VerticalLayout();
		verticalLayout_2.setImmediate(false);
		verticalLayout_2.setWidth("-1px");
		verticalLayout_2.setHeight("-1px");
		verticalLayout_2.setMargin(false);
		
		// cmbNivel1
		cmbNivel1 = new ComboBox();
		cmbNivel1.setCaption("Primer Nivel");
		cmbNivel1.setImmediate(false);
		cmbNivel1.setWidth("300px");
		cmbNivel1.setHeight("24px");
		verticalLayout_2.addComponent(cmbNivel1);
		
		// cmbNivel2
		cmbNivel2 = new ComboBox();
		cmbNivel2.setCaption("Segundo Nivel");
		cmbNivel2.setImmediate(false);
		cmbNivel2.setWidth("300px");
		cmbNivel2.setHeight("-1px");
		verticalLayout_2.addComponent(cmbNivel2);
		
		// cmbNivel3
		cmbNivel3 = new ComboBox();
		cmbNivel3.setCaption("Tercer Nivel");
		cmbNivel3.setImmediate(false);
		cmbNivel3.setWidth("300px");
		cmbNivel3.setHeight("-1px");
		verticalLayout_2.addComponent(cmbNivel3);
		
		// cmbNivel4
		cmbNivel4 = new ComboBox();
		cmbNivel4.setCaption("Cuarto Nivel");
		cmbNivel4.setImmediate(false);
		cmbNivel4.setWidth("300px");
		cmbNivel4.setHeight("-1px");
		verticalLayout_2.addComponent(cmbNivel4);
		
		// cmbNivel5
		cmbNivel5 = new ComboBox();
		cmbNivel5.setCaption("Quinto Nivel");
		cmbNivel5.setImmediate(false);
		cmbNivel5.setWidth("300px");
		cmbNivel5.setHeight("-1px");
		verticalLayout_2.addComponent(cmbNivel5);
		
		// cmbNivel6
		cmbNivel6 = new ComboBox();
		cmbNivel6.setCaption("Sexto Nivel");
		cmbNivel6.setImmediate(false);
		cmbNivel6.setWidth("300px");
		cmbNivel6.setHeight("-1px");
		verticalLayout_2.addComponent(cmbNivel6);
		
		// cmbNivel7
		cmbNivel7 = new ComboBox();
		cmbNivel7.setCaption("Septimo Nivel");
		cmbNivel7.setImmediate(false);
		cmbNivel7.setWidth("300px");
		cmbNivel7.setHeight("-1px");
		verticalLayout_2.addComponent(cmbNivel7);
		
		return verticalLayout_2;
	}
}
