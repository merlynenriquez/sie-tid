
package pe.gob.mininter.dirandro.vaadin.panel;

import java.util.List;

import pe.gob.mininter.dirandro.model.Empresa;
import pe.gob.mininter.dirandro.model.Expediente;
import pe.gob.mininter.dirandro.model.Persona;
import pe.gob.mininter.dirandro.service.EmpresaService;
import pe.gob.mininter.dirandro.service.ExpedienteService;
import pe.gob.mininter.dirandro.service.PersonaService;
import pe.gob.mininter.dirandro.vaadin.util.Injector;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.data.util.BeanItemContainer;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.OptionGroup;
import com.vaadin.ui.PopupDateField;
import com.vaadin.ui.Table;
import com.vaadin.ui.TextField;
import com.vaadin.ui.VerticalLayout;

public class PanelRegistroParteInterviniente extends CustomComponent {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */
	
	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private VerticalLayout verticalLayout_3;
	@AutoGenerated
	private Table tblIntervinientes;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_34;
	@AutoGenerated
	private Button btnRIAgregar;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_1;
	@AutoGenerated
	private TextField txtInterAlias;
	@AutoGenerated
	private ComboBox cmbInterSituacion;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_32;
	@AutoGenerated
	private PopupDateField dtInterFechaInter;
	@AutoGenerated
	private ComboBox cmbInterOcupacion;
	@AutoGenerated
	private ComboBox cmbInterOrganizacion;
	@AutoGenerated
	private ComboBox cmbInterRequisitoriado;
	@AutoGenerated
	private ComboBox cmbInterEstadoDato;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_9;
	@AutoGenerated
	private TextField txtRiSexo;
	@AutoGenerated
	private TextField txtRiNacionalidad;
	@AutoGenerated
	private TextField txtRiNombre;
	@AutoGenerated
	private TextField txtRiNroDocumento;
	@AutoGenerated
	private TextField txtTipoDocumento;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_3;
	@AutoGenerated
	private Button btnRIBuscar;
	@AutoGenerated
	private ComboBox cmbRiIntervinientes;
	@AutoGenerated
	private OptionGroup rbTipoInterviniente;
	private static final long serialVersionUID = 5321154660254559464L;
	
	private PersonaService personaService;
	private EmpresaService empresaService;
	
	private Expediente expediente;
	private List<Empresa> lstEmpresas;
	private List<Persona> lstPersonas;
	private String listaSeleccionada="persona";
	
	public void setExpediente(Expediente expediente) {
		this.expediente = expediente;
	}
	
	public PanelRegistroParteInterviniente() {
		buildMainLayout();
		personaService = Injector.obtenerServicio(PersonaService.class);
		empresaService = Injector.obtenerServicio(EmpresaService.class);
		setCompositionRoot(mainLayout);
		postConstruct();
	}
	
	public void postConstruct() {
		
		//FIXME dummy para test
		ExpedienteService expedienteService = Injector.obtenerServicio(ExpedienteService.class);
		expediente=expedienteService.obtener(1l);
		
		rbTipoInterviniente.addItem("Persona");
		rbTipoInterviniente.addItem("Empresa");
		rbTipoInterviniente.select("Persona");
		rbTipoInterviniente.setImmediate(true);
		rbTipoInterviniente.addListener(new ValueChangeListener() {
			private static final long serialVersionUID = 2720977948538256976L;
			@Override
			public void valueChange(ValueChangeEvent event) {
				rbTipoIntervinienteValueChange(event);
			}
		});
		
		cmbRiIntervinientes.setInputPrompt("Incautado a:");
		cmbRiIntervinientes.setItemCaptionPropertyId("nombreCompleto");
		cmbRiIntervinientes.setImmediate(true);
		cargaComboPersonaIncautada("persona");
		
		
	}


	private void rbTipoIntervinienteValueChange(ValueChangeEvent event){		
		boolean opcion = event.getProperty().getValue().equals("Persona");
		cmbRiIntervinientes.select(null);
		if(opcion){
			cargaComboPersonaIncautada("persona");
		}else{
			cargaComboPersonaIncautada("empresa");
		}
	}
	
	private void cargaComboPersonaIncautada(String opcion){
		if(opcion.equals("persona")){
			listaSeleccionada="persona";
			if(lstPersonas ==null)
				lstPersonas = personaService.buscar( null );
			cmbRiIntervinientes.setItemCaptionPropertyId("nombreCompleto");
			cmbRiIntervinientes.setContainerDataSource(new BeanItemContainer<Persona>(Persona.class,  lstPersonas));
		}else{
			listaSeleccionada="empresa";
			cmbRiIntervinientes.setItemCaptionPropertyId("razonSocial");
			if(lstEmpresas==null)
				lstEmpresas = empresaService.buscar( null );
			cmbRiIntervinientes.setContainerDataSource(new BeanItemContainer<Empresa>(Empresa.class,  lstEmpresas));
		}
	}
	
	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(false);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("-1px");
		
		// verticalLayout_3
		verticalLayout_3 = buildVerticalLayout_3();
		mainLayout.addComponent(verticalLayout_3);
		
		return mainLayout;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_3() {
		// common part: create layout
		verticalLayout_3 = new VerticalLayout();
		verticalLayout_3.setImmediate(false);
		verticalLayout_3.setWidth("-1px");
		verticalLayout_3.setHeight("-1px");
		verticalLayout_3.setMargin(true);
		verticalLayout_3.setSpacing(true);
		
		// horizontalLayout_3
		horizontalLayout_3 = buildHorizontalLayout_3();
		verticalLayout_3.addComponent(horizontalLayout_3);
		
		// horizontalLayout_9
		horizontalLayout_9 = buildHorizontalLayout_9();
		verticalLayout_3.addComponent(horizontalLayout_9);
		
		// horizontalLayout_32
		horizontalLayout_32 = buildHorizontalLayout_32();
		verticalLayout_3.addComponent(horizontalLayout_32);
		
		// horizontalLayout_34
		horizontalLayout_34 = buildHorizontalLayout_34();
		verticalLayout_3.addComponent(horizontalLayout_34);
		
		// tblIntervinientes
		tblIntervinientes = new Table();
		tblIntervinientes.setImmediate(false);
		tblIntervinientes.setWidth("900px");
		tblIntervinientes.setHeight("350px");
		verticalLayout_3.addComponent(tblIntervinientes);
		
		return verticalLayout_3;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_3() {
		// common part: create layout
		horizontalLayout_3 = new HorizontalLayout();
		horizontalLayout_3.setImmediate(false);
		horizontalLayout_3.setWidth("-1px");
		horizontalLayout_3.setHeight("-1px");
		horizontalLayout_3.setMargin(false);
		horizontalLayout_3.setSpacing(true);
		
		// rbTipoInterviniente
		rbTipoInterviniente = new OptionGroup();
		rbTipoInterviniente.setStyleName("horizontal");
		rbTipoInterviniente.setCaption("Tipo de Interviniente");
		rbTipoInterviniente.setImmediate(false);
		rbTipoInterviniente.setWidth("-1px");
		rbTipoInterviniente.setHeight("25px");
		horizontalLayout_3.addComponent(rbTipoInterviniente);
		
		// cmbRiIntervinientes
		cmbRiIntervinientes = new ComboBox();
		cmbRiIntervinientes.setCaption("Interviniente");
		cmbRiIntervinientes.setImmediate(false);
		cmbRiIntervinientes.setWidth("350px");
		cmbRiIntervinientes.setHeight("-1px");
		horizontalLayout_3.addComponent(cmbRiIntervinientes);
		
		// btnRIBuscar
		btnRIBuscar = new Button();
		btnRIBuscar.setCaption("Registrar");
		btnRIBuscar.setImmediate(true);
		btnRIBuscar.setWidth("-1px");
		btnRIBuscar.setHeight("-1px");
		horizontalLayout_3.addComponent(btnRIBuscar);
		horizontalLayout_3.setComponentAlignment(btnRIBuscar, new Alignment(9));
		
		return horizontalLayout_3;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_9() {
		// common part: create layout
		horizontalLayout_9 = new HorizontalLayout();
		horizontalLayout_9.setImmediate(false);
		horizontalLayout_9.setWidth("-1px");
		horizontalLayout_9.setHeight("-1px");
		horizontalLayout_9.setMargin(false);
		horizontalLayout_9.setSpacing(true);
		
		// txtTipoDocumento
		txtTipoDocumento = new TextField();
		txtTipoDocumento.setCaption("Tipo de Documento");
		txtTipoDocumento.setImmediate(false);
		txtTipoDocumento.setWidth("-1px");
		txtTipoDocumento.setHeight("-1px");
		horizontalLayout_9.addComponent(txtTipoDocumento);
		
		// txtRiNroDocumento
		txtRiNroDocumento = new TextField();
		txtRiNroDocumento.setCaption("Nro. de Documento");
		txtRiNroDocumento.setImmediate(false);
		txtRiNroDocumento.setWidth("-1px");
		txtRiNroDocumento.setHeight("-1px");
		horizontalLayout_9.addComponent(txtRiNroDocumento);
		
		// txtRiNombre
		txtRiNombre = new TextField();
		txtRiNombre.setCaption("Nombre Completo");
		txtRiNombre.setImmediate(false);
		txtRiNombre.setWidth("300px");
		txtRiNombre.setHeight("-1px");
		horizontalLayout_9.addComponent(txtRiNombre);
		
		// txtRiNacionalidad
		txtRiNacionalidad = new TextField();
		txtRiNacionalidad.setCaption("Nacionalidad");
		txtRiNacionalidad.setImmediate(false);
		txtRiNacionalidad.setWidth("-1px");
		txtRiNacionalidad.setHeight("-1px");
		horizontalLayout_9.addComponent(txtRiNacionalidad);
		
		// txtRiSexo
		txtRiSexo = new TextField();
		txtRiSexo.setCaption("Sexo");
		txtRiSexo.setImmediate(false);
		txtRiSexo.setWidth("60px");
		txtRiSexo.setHeight("-1px");
		horizontalLayout_9.addComponent(txtRiSexo);
		
		return horizontalLayout_9;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_32() {
		// common part: create layout
		horizontalLayout_32 = new HorizontalLayout();
		horizontalLayout_32.setImmediate(false);
		horizontalLayout_32.setWidth("-1px");
		horizontalLayout_32.setHeight("-1px");
		horizontalLayout_32.setMargin(false);
		horizontalLayout_32.setSpacing(true);
		
		// cmbInterEstadoDato
		cmbInterEstadoDato = new ComboBox();
		cmbInterEstadoDato.setCaption("Estado del dato");
		cmbInterEstadoDato.setImmediate(false);
		cmbInterEstadoDato.setWidth("-1px");
		cmbInterEstadoDato.setHeight("-1px");
		horizontalLayout_32.addComponent(cmbInterEstadoDato);
		
		// cmbInterRequisitoriado
		cmbInterRequisitoriado = new ComboBox();
		cmbInterRequisitoriado.setCaption("Requisitoriado");
		cmbInterRequisitoriado.setImmediate(false);
		cmbInterRequisitoriado.setWidth("-1px");
		cmbInterRequisitoriado.setHeight("-1px");
		horizontalLayout_32.addComponent(cmbInterRequisitoriado);
		
		// cmbInterOrganizacion
		cmbInterOrganizacion = new ComboBox();
		cmbInterOrganizacion.setCaption("Organización");
		cmbInterOrganizacion.setImmediate(false);
		cmbInterOrganizacion.setWidth("-1px");
		cmbInterOrganizacion.setHeight("-1px");
		horizontalLayout_32.addComponent(cmbInterOrganizacion);
		
		// cmbInterOcupacion
		cmbInterOcupacion = new ComboBox();
		cmbInterOcupacion.setCaption("Ocupación");
		cmbInterOcupacion.setImmediate(false);
		cmbInterOcupacion.setWidth("-1px");
		cmbInterOcupacion.setHeight("-1px");
		horizontalLayout_32.addComponent(cmbInterOcupacion);
		
		// dtInterFechaInter
		dtInterFechaInter = new PopupDateField();
		dtInterFechaInter.setCaption("Fecha Intervención");
		dtInterFechaInter.setImmediate(false);
		dtInterFechaInter.setWidth("-1px");
		dtInterFechaInter.setHeight("-1px");
		dtInterFechaInter.setInvalidAllowed(false);
		horizontalLayout_32.addComponent(dtInterFechaInter);
		
		return horizontalLayout_32;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_34() {
		// common part: create layout
		horizontalLayout_34 = new HorizontalLayout();
		horizontalLayout_34.setImmediate(false);
		horizontalLayout_34.setWidth("870px");
		horizontalLayout_34.setHeight("-1px");
		horizontalLayout_34.setMargin(false);
		horizontalLayout_34.setSpacing(true);
		
		// horizontalLayout_1
		horizontalLayout_1 = buildHorizontalLayout_1();
		horizontalLayout_34.addComponent(horizontalLayout_1);
		
		// btnRIAgregar
		btnRIAgregar = new Button();
		btnRIAgregar.setCaption("Agregar Interviniente");
		btnRIAgregar.setImmediate(true);
		btnRIAgregar.setWidth("-1px");
		btnRIAgregar.setHeight("-1px");
		horizontalLayout_34.addComponent(btnRIAgregar);
		horizontalLayout_34.setComponentAlignment(btnRIAgregar, new Alignment(
				10));
		
		return horizontalLayout_34;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_1() {
		// common part: create layout
		horizontalLayout_1 = new HorizontalLayout();
		horizontalLayout_1.setImmediate(false);
		horizontalLayout_1.setWidth("-1px");
		horizontalLayout_1.setHeight("-1px");
		horizontalLayout_1.setMargin(false);
		horizontalLayout_1.setSpacing(true);
		
		// cmbInterSituacion
		cmbInterSituacion = new ComboBox();
		cmbInterSituacion.setCaption("Situación");
		cmbInterSituacion.setImmediate(false);
		cmbInterSituacion.setWidth("-1px");
		cmbInterSituacion.setHeight("-1px");
		horizontalLayout_1.addComponent(cmbInterSituacion);
		
		// txtInterAlias
		txtInterAlias = new TextField();
		txtInterAlias.setCaption("Alias");
		txtInterAlias.setImmediate(false);
		txtInterAlias.setWidth("-1px");
		txtInterAlias.setHeight("-1px");
		horizontalLayout_1.addComponent(txtInterAlias);
		
		return horizontalLayout_1;
	}

}
