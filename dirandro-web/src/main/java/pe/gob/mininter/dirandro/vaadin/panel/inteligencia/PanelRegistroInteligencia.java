package pe.gob.mininter.dirandro.vaadin.panel.inteligencia;

import java.util.Iterator;
import java.util.List;

import org.apache.log4j.Logger;

import pe.gob.mininter.dirandro.model.Inteligencia;
import pe.gob.mininter.dirandro.model.Opcion;
import pe.gob.mininter.dirandro.util.HarecUtil;
import pe.gob.mininter.dirandro.vaadin.util.DirandroComponent;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Component;
import com.vaadin.ui.TabSheet;
import com.vaadin.ui.TabSheet.SelectedTabChangeEvent;
import com.vaadin.ui.TabSheet.SelectedTabChangeListener;
import com.vaadin.ui.TabSheet.Tab;
import com.vaadin.ui.VerticalLayout;

public class PanelRegistroInteligencia extends DirandroComponent implements SelectedTabChangeListener {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */
	
	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private VerticalLayout pnlPrincipal;
	@AutoGenerated
	private TabSheet tabRegistroDocumento;
	@AutoGenerated
	private VerticalLayout tabOrganizaciones;
	@AutoGenerated
	private PanelRegistroInteligenciaOrganizacion panelRegistroInteligenciaOrganizacion;
	@AutoGenerated
	private VerticalLayout tabZona;
	@AutoGenerated
	private PanelRegistroInteligenciaCultivo pnlZonaCultivo;
	@AutoGenerated
	private VerticalLayout tabGremio;
	@AutoGenerated
	private PanelRegistroInteligenciaGremio pnlGremio;
	@AutoGenerated
	private VerticalLayout tabAerodromo;
	@AutoGenerated
	private PanelRegistroInteligenciaAerodromo pnlAerodromo;
	@AutoGenerated
	private VerticalLayout tabRutas;
	@AutoGenerated
	private PanelRegistroInteligenciaRutaTID pnlRutaTID;
	@AutoGenerated
	private VerticalLayout tabDocumento;
	@AutoGenerated
	private PanelRegistroInteligenciaPrincipal pnlDocumento;
	private static final long serialVersionUID = -4639683924066371051L;
	private final Logger logger = Logger.getLogger(PanelRegistroInteligencia.class);
	
	private Inteligencia inteligencia;
	
	public PanelRegistroInteligencia( List<Opcion> acciones, String height ) {
		super( acciones , height );
		buildMainLayout();
		setCompositionRoot(mainLayout);
		postConstruct();
		setInteligencia(new Inteligencia());
	}

	public Inteligencia getInteligencia() {
		return inteligencia;
	}
	
	public void setInteligencia(Inteligencia inteligencia) {
		this.inteligencia = inteligencia;
		logger.debug("inteligencia"+HarecUtil.nullToEmpty(inteligencia.getAutogenerado()));
		pnlDocumento.setInteligencia(inteligencia);
	}

	@Override
	public void postConstruct() {
		tabRegistroDocumento.addListener((SelectedTabChangeListener) this);
		habilitarTab(false);
		tabRegistroDocumento.getTab(0).setEnabled(true);
	}
	
	public void habilitarTab(boolean flag) {
		Iterator<Component> i = tabRegistroDocumento.getComponentIterator();
		while (i.hasNext()) {
		    Component c = (Component) i.next();
		    Tab tab = tabRegistroDocumento.getTab(c);
		    tab.setEnabled(flag);
		}
	}
	
	@Override
	public void attach() {
		super.attach();
		
		pnlDocumento.setPadre(this);		
		if(!inteligencia.esNuevo()) {
			pnlDocumento.cargarFormulario();
			habilitarTab(true);
		}
	}

	@Override
	public void selectedTabChange(SelectedTabChangeEvent event) {
		if(event.getTabSheet().isEnabled()){
			if(pnlRutaTID.equals(event.getTabSheet().getSelectedTab())){
				pnlRutaTID.setInteligencia(inteligencia);
			}	
			
			if(tabAerodromo.equals(event.getTabSheet().getSelectedTab())){
				pnlAerodromo.setInteligencia(inteligencia);
			}
			if(tabOrganizaciones.equals(event.getTabSheet().getSelectedTab())){
				panelRegistroInteligenciaOrganizacion.setInteligencia(inteligencia);
			}
			if(tabGremio.equals(event.getTabSheet().getSelectedTab())){
				pnlGremio.setInteligencia(inteligencia);
			}
			
		}
	
	}


	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(false);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("-1px");
		
		// pnlPrincipal
		pnlPrincipal = buildPnlPrincipal();
		mainLayout.addComponent(pnlPrincipal);
		mainLayout.setComponentAlignment(pnlPrincipal, new Alignment(20));
		
		return mainLayout;
	}

	@AutoGenerated
	private VerticalLayout buildPnlPrincipal() {
		// common part: create layout
		pnlPrincipal = new VerticalLayout();
		pnlPrincipal.setImmediate(false);
		pnlPrincipal.setWidth("-1px");
		pnlPrincipal.setHeight("-1px");
		pnlPrincipal.setMargin(true);
		pnlPrincipal.setSpacing(true);
		
		// tabRegistroDocumento
		tabRegistroDocumento = buildTabRegistroDocumento();
		pnlPrincipal.addComponent(tabRegistroDocumento);
		pnlPrincipal.setComponentAlignment(tabRegistroDocumento, new Alignment(
				20));
		
		return pnlPrincipal;
	}

	@AutoGenerated
	private TabSheet buildTabRegistroDocumento() {
		// common part: create layout
		tabRegistroDocumento = new TabSheet();
		tabRegistroDocumento.setImmediate(true);
		tabRegistroDocumento.setWidth("950px");
		tabRegistroDocumento.setHeight("700px");
		
		// tabDocumento
		tabDocumento = buildTabDocumento();
		tabRegistroDocumento.addTab(tabDocumento, "Documento de Inteligencia",
				null);
		
		// tabRutas
		tabRutas = buildTabRutas();
		tabRegistroDocumento.addTab(tabRutas, "Rutas TID", null);
		
		// tabAerodromo
		tabAerodromo = buildTabAerodromo();
		tabRegistroDocumento.addTab(tabAerodromo, "Aerodromo", null);
		
		// tabGremio
		tabGremio = buildTabGremio();
		tabRegistroDocumento.addTab(tabGremio, "Gremio Cocalero", null);
		
		// tabZona
		tabZona = buildTabZona();
		tabRegistroDocumento.addTab(tabZona, "Zona de Cultivo", null);
		
		// tabOrganizaciones
		tabOrganizaciones = buildTabOrganizaciones();
		tabRegistroDocumento.addTab(tabOrganizaciones, "Organizaciones", null);
		
		return tabRegistroDocumento;
	}

	@AutoGenerated
	private VerticalLayout buildTabDocumento() {
		// common part: create layout
		tabDocumento = new VerticalLayout();
		tabDocumento.setImmediate(false);
		tabDocumento.setWidth("100.0%");
		tabDocumento.setHeight("-1px");
		tabDocumento.setMargin(false);
		
		// pnlDocumento
		pnlDocumento = new PanelRegistroInteligenciaPrincipal();
		pnlDocumento.setImmediate(false);
		pnlDocumento.setWidth("-1px");
		pnlDocumento.setHeight("-1px");
		tabDocumento.addComponent(pnlDocumento);
		
		return tabDocumento;
	}

	@AutoGenerated
	private VerticalLayout buildTabRutas() {
		// common part: create layout
		tabRutas = new VerticalLayout();
		tabRutas.setImmediate(false);
		tabRutas.setWidth("100.0%");
		tabRutas.setHeight("-1px");
		tabRutas.setMargin(false);
		
		// pnlRutaTID
		pnlRutaTID = new PanelRegistroInteligenciaRutaTID();
		pnlRutaTID.setImmediate(false);
		pnlRutaTID.setWidth("-1px");
		pnlRutaTID.setHeight("-1px");
		tabRutas.addComponent(pnlRutaTID);
		
		return tabRutas;
	}

	@AutoGenerated
	private VerticalLayout buildTabAerodromo() {
		// common part: create layout
		tabAerodromo = new VerticalLayout();
		tabAerodromo.setImmediate(false);
		tabAerodromo.setWidth("-1px");
		tabAerodromo.setHeight("-1px");
		tabAerodromo.setMargin(false);
		
		// pnlAerodromo
		pnlAerodromo = new PanelRegistroInteligenciaAerodromo();
		pnlAerodromo.setImmediate(false);
		pnlAerodromo.setWidth("-1px");
		pnlAerodromo.setHeight("-1px");
		tabAerodromo.addComponent(pnlAerodromo);
		
		return tabAerodromo;
	}

	@AutoGenerated
	private VerticalLayout buildTabGremio() {
		// common part: create layout
		tabGremio = new VerticalLayout();
		tabGremio.setImmediate(false);
		tabGremio.setWidth("-1px");
		tabGremio.setHeight("-1px");
		tabGremio.setMargin(false);
		
		// pnlGremio
		pnlGremio = new PanelRegistroInteligenciaGremio();
		pnlGremio.setImmediate(false);
		pnlGremio.setWidth("-1px");
		pnlGremio.setHeight("-1px");
		tabGremio.addComponent(pnlGremio);
		
		return tabGremio;
	}

	@AutoGenerated
	private VerticalLayout buildTabZona() {
		// common part: create layout
		tabZona = new VerticalLayout();
		tabZona.setImmediate(false);
		tabZona.setWidth("-1px");
		tabZona.setHeight("-1px");
		tabZona.setMargin(false);
		
		// pnlZonaCultivo
		pnlZonaCultivo = new PanelRegistroInteligenciaCultivo();
		pnlZonaCultivo.setImmediate(false);
		pnlZonaCultivo.setWidth("-1px");
		pnlZonaCultivo.setHeight("-1px");
		tabZona.addComponent(pnlZonaCultivo);
		
		return tabZona;
	}

	@AutoGenerated
	private VerticalLayout buildTabOrganizaciones() {
		// common part: create layout
		tabOrganizaciones = new VerticalLayout();
		tabOrganizaciones.setImmediate(false);
		tabOrganizaciones.setWidth("-1px");
		tabOrganizaciones.setHeight("-1px");
		tabOrganizaciones.setMargin(false);
		
		// panelRegistroInteligenciaOrganizacion
		panelRegistroInteligenciaOrganizacion = new PanelRegistroInteligenciaOrganizacion();
		panelRegistroInteligenciaOrganizacion.setImmediate(false);
		panelRegistroInteligenciaOrganizacion.setWidth("-1px");
		panelRegistroInteligenciaOrganizacion.setHeight("-1px");
		tabOrganizaciones.addComponent(panelRegistroInteligenciaOrganizacion);
		
		return tabOrganizaciones;
	}

}
