package pe.gob.mininter.dirandro.vaadin.panel.caso;

import java.util.Iterator;
import java.util.List;

import org.apache.log4j.Logger;

import pe.gob.mininter.dirandro.model.Caso;
import pe.gob.mininter.dirandro.model.Opcion;
import pe.gob.mininter.dirandro.util.HarecUtil;
import pe.gob.mininter.dirandro.vaadin.util.DirandroComponent;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Component;
import com.vaadin.ui.TabSheet;
import com.vaadin.ui.TabSheet.SelectedTabChangeEvent;
import com.vaadin.ui.TabSheet.SelectedTabChangeListener;
import com.vaadin.ui.TabSheet.Tab;
import com.vaadin.ui.VerticalLayout;

public class PanelRegistroCaso extends DirandroComponent implements SelectedTabChangeListener {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */
	
	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private VerticalLayout pnlPrincipal;
	@AutoGenerated
	private TabSheet tabRegistroCaso;
	@AutoGenerated
	private VerticalLayout tabIamgenes;
	@AutoGenerated
	private PanelRegistroCasoImagen pnlCasoImagen;
	@AutoGenerated
	private VerticalLayout tabDireccion;
	@AutoGenerated
	private PanelRegistroCasoDireccion pnlCasoDireccion;
	@AutoGenerated
	private VerticalLayout tabVehiculos;
	@AutoGenerated
	private PanelRegistroCasoVehiculo pnlCasoVehiculo;
	@AutoGenerated
	private VerticalLayout tabParticipantes;
	@AutoGenerated
	private TabSheet tabPersonas;
	@AutoGenerated
	private PanelRegistroCasoNoIdentificado pnlNoIdentificado;
	@AutoGenerated
	private PanelRegistroCasoInterviniente pnlIntervinientes;
	@AutoGenerated
	private VerticalLayout tabCasos;
	@AutoGenerated
	private PanelRegistroCasoPrincipal pnlCasoPrincipal;
	private static final long serialVersionUID = -4639683924066371051L;
	private final Logger logger = Logger.getLogger(PanelRegistroCaso.class);
	
	private Caso caso;
	
	public PanelRegistroCaso( List<Opcion> acciones, String height ) {
		super( acciones , height );
		buildMainLayout();
		setCompositionRoot(mainLayout);
		setCaso(new Caso());
		postConstruct();
	}
	
	@Override
	public void postConstruct() {
		
		tabRegistroCaso.addListener((SelectedTabChangeListener) this);
		tabPersonas.addListener((SelectedTabChangeListener) this);
		
		habilitarTab(false);
		tabRegistroCaso.getTab(0).setEnabled(true);
	
	}
	
	public void habilitarTab(boolean flag) {
		Iterator<Component> i = tabRegistroCaso.getComponentIterator();
		while (i.hasNext()) {
		    Component c = (Component) i.next();
		    Tab tab = tabRegistroCaso.getTab(c);
		    tab.setEnabled(flag);
		}
	}
	
	@Override
	public void attach() {
		super.attach();
		
		pnlCasoPrincipal.setPadre(this);		
		if(!caso.esNuevo()) {
			//pnlCasoPrincipal.cargarFormulario();
			habilitarTab(true);
		}
	}

	@Override
	public void selectedTabChange(SelectedTabChangeEvent event) {
//		if(pnlAgregarDocumento.equals(event.getTabSheet().getSelectedTab())){
//			pnlAgregarDocumento.cargarDocumentos();
//		}
		
		if(event.getTabSheet().isEnabled()){

			if(tabParticipantes.equals(event.getTabSheet().getSelectedTab())){
				logger.debug("cargar panel principal del caso");
				pnlIntervinientes.setCaso(caso);
				pnlNoIdentificado.setCaso(caso);
			}
			if(tabDireccion.equals(event.getTabSheet().getSelectedTab())){
				logger.debug("cargar panel principal del caso");
				pnlCasoDireccion.setCaso(caso);
			}
			if(tabVehiculos.equals(event.getTabSheet().getSelectedTab())){
				logger.debug("cargar panel principal del caso");
				pnlCasoVehiculo.setCaso(caso);
			}
			if(tabIamgenes.equals(event.getTabSheet().getSelectedTab())){
				logger.debug("cargar panel principal del caso");
				pnlCasoImagen.setCaso(caso);
			}
		}
	
	}
	
	public void setCaso(Caso caso) {
		this.caso = caso;
		logger.debug("caso = " + HarecUtil.nullToEmpty(caso.getNroCaso()) );
		pnlCasoPrincipal.setCaso(caso);
	}
	

	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(false);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("-1px");
		
		// pnlPrincipal
		pnlPrincipal = buildPnlPrincipal();
		mainLayout.addComponent(pnlPrincipal);
		mainLayout.setComponentAlignment(pnlPrincipal, new Alignment(20));
		
		return mainLayout;
	}

	@AutoGenerated
	private VerticalLayout buildPnlPrincipal() {
		// common part: create layout
		pnlPrincipal = new VerticalLayout();
		pnlPrincipal.setImmediate(false);
		pnlPrincipal.setWidth("-1px");
		pnlPrincipal.setHeight("-1px");
		pnlPrincipal.setMargin(true);
		pnlPrincipal.setSpacing(true);
		
		// tabRegistroCaso
		tabRegistroCaso = buildTabRegistroCaso();
		pnlPrincipal.addComponent(tabRegistroCaso);
		pnlPrincipal.setComponentAlignment(tabRegistroCaso, new Alignment(20));
		
		return pnlPrincipal;
	}

	@AutoGenerated
	private TabSheet buildTabRegistroCaso() {
		// common part: create layout
		tabRegistroCaso = new TabSheet();
		tabRegistroCaso.setImmediate(true);
		tabRegistroCaso.setWidth("950px");
		tabRegistroCaso.setHeight("700px");
		
		// tabCasos
		tabCasos = buildTabCasos();
		tabRegistroCaso.addTab(tabCasos, "Registrar Caso", null);
		
		// tabParticipantes
		tabParticipantes = buildTabParticipantes();
		tabRegistroCaso.addTab(tabParticipantes, "Personas", null);
		
		// tabVehiculos
		tabVehiculos = buildTabVehiculos();
		tabRegistroCaso.addTab(tabVehiculos, "Vehiculos", null);
		
		// tabDireccion
		tabDireccion = buildTabDireccion();
		tabRegistroCaso.addTab(tabDireccion, "Direcciones", null);
		
		// tabIamgenes
		tabIamgenes = buildTabIamgenes();
		tabRegistroCaso.addTab(tabIamgenes, "Imagenes", null);
		
		return tabRegistroCaso;
	}

	@AutoGenerated
	private VerticalLayout buildTabCasos() {
		// common part: create layout
		tabCasos = new VerticalLayout();
		tabCasos.setImmediate(false);
		tabCasos.setWidth("-1px");
		tabCasos.setHeight("-1px");
		tabCasos.setMargin(false);
		
		// pnlCasoPrincipal
		pnlCasoPrincipal = new PanelRegistroCasoPrincipal();
		pnlCasoPrincipal.setImmediate(false);
		pnlCasoPrincipal.setWidth("100.0%");
		pnlCasoPrincipal.setHeight("100.0%");
		tabCasos.addComponent(pnlCasoPrincipal);
		
		return tabCasos;
	}

	@AutoGenerated
	private VerticalLayout buildTabParticipantes() {
		// common part: create layout
		tabParticipantes = new VerticalLayout();
		tabParticipantes.setImmediate(false);
		tabParticipantes.setWidth("100.0%");
		tabParticipantes.setHeight("-1px");
		tabParticipantes.setMargin(false);
		
		// tabPersonas
		tabPersonas = buildTabPersonas();
		tabParticipantes.addComponent(tabPersonas);
		
		return tabParticipantes;
	}

	@AutoGenerated
	private TabSheet buildTabPersonas() {
		// common part: create layout
		tabPersonas = new TabSheet();
		tabPersonas.setImmediate(true);
		tabPersonas.setWidth("100.0%");
		tabPersonas.setHeight("100.0%");
		
		// pnlIntervinientes
		pnlIntervinientes = new PanelRegistroCasoInterviniente();
		pnlIntervinientes.setImmediate(false);
		pnlIntervinientes.setWidth("100.0%");
		pnlIntervinientes.setHeight("500px");
		tabPersonas.addTab(pnlIntervinientes, "Intervinientes", null);
		
		// pnlNoIdentificado
		pnlNoIdentificado = new PanelRegistroCasoNoIdentificado();
		pnlNoIdentificado.setImmediate(false);
		pnlNoIdentificado.setWidth("100.0%");
		pnlNoIdentificado.setHeight("500px");
		tabPersonas.addTab(pnlNoIdentificado, "No Identificados", null);
		
		return tabPersonas;
	}

	@AutoGenerated
	private VerticalLayout buildTabVehiculos() {
		// common part: create layout
		tabVehiculos = new VerticalLayout();
		tabVehiculos.setImmediate(false);
		tabVehiculos.setWidth("100.0%");
		tabVehiculos.setHeight("-1px");
		tabVehiculos.setMargin(false);
		
		// pnlCasoVehiculo
		pnlCasoVehiculo = new PanelRegistroCasoVehiculo();
		pnlCasoVehiculo.setImmediate(false);
		pnlCasoVehiculo.setWidth("100.0%");
		pnlCasoVehiculo.setHeight("500px");
		tabVehiculos.addComponent(pnlCasoVehiculo);
		
		return tabVehiculos;
	}

	@AutoGenerated
	private VerticalLayout buildTabDireccion() {
		// common part: create layout
		tabDireccion = new VerticalLayout();
		tabDireccion.setImmediate(false);
		tabDireccion.setWidth("-1px");
		tabDireccion.setHeight("-1px");
		tabDireccion.setMargin(false);
		
		// pnlCasoDireccion
		pnlCasoDireccion = new PanelRegistroCasoDireccion();
		pnlCasoDireccion.setImmediate(false);
		pnlCasoDireccion.setWidth("100.0%");
		pnlCasoDireccion.setHeight("500px");
		tabDireccion.addComponent(pnlCasoDireccion);
		
		return tabDireccion;
	}

	@AutoGenerated
	private VerticalLayout buildTabIamgenes() {
		// common part: create layout
		tabIamgenes = new VerticalLayout();
		tabIamgenes.setImmediate(false);
		tabIamgenes.setWidth("-1px");
		tabIamgenes.setHeight("-1px");
		tabIamgenes.setMargin(false);
		
		// pnlCasoImagen
		pnlCasoImagen = new PanelRegistroCasoImagen();
		pnlCasoImagen.setImmediate(false);
		pnlCasoImagen.setWidth("100.0%");
		pnlCasoImagen.setHeight("500px");
		tabIamgenes.addComponent(pnlCasoImagen);
		
		return tabIamgenes;
	}

}
