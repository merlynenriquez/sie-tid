package pe.gob.mininter.dirandro.vaadin.panel;

import org.apache.commons.lang.StringUtils;

import pe.gob.mininter.dirandro.model.Expediente;
import pe.gob.mininter.dirandro.model.Importe;
import pe.gob.mininter.dirandro.service.ImporteService;
import pe.gob.mininter.dirandro.util.Constante;
import pe.gob.mininter.dirandro.vaadin.util.ComboBoxLOVS;
import pe.gob.mininter.dirandro.vaadin.util.Injector;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.OptionGroup;
import com.vaadin.ui.Table;
import com.vaadin.ui.TextField;
import com.vaadin.ui.VerticalLayout;

public class PanelRegistroParteDinero extends CustomComponent implements ClickListener {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */
	
	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private Table tblDinero;
	@AutoGenerated
	private Button btnRegistrar;
	@AutoGenerated
	private HorizontalLayout horizontalLayout_25;
	@AutoGenerated
	private TextField txtNroTarjeta;
	@AutoGenerated
	private TextField txtNroCuenta;
	@AutoGenerated
	private ComboBoxLOVS cmbBanco;
	@AutoGenerated
	private ComboBoxLOVS cmbTipoCuenta;
	@AutoGenerated
	private HorizontalLayout pnlPrincipal;
	@AutoGenerated
	private OptionGroup rbAutenticidad;
	@AutoGenerated
	private ComboBoxLOVS cmbSituacion;
	@AutoGenerated
	private TextField txtMonto;
	@AutoGenerated
	private ComboBoxLOVS cmbTipoMoneda;
	
	private static final long serialVersionUID = -4639683924066371051L;
	
	private Expediente expediente;
	private Importe expImporte;
	private boolean inicializado;
	private ImporteService importeService;
	
	public PanelRegistroParteDinero() {
		buildMainLayout();
		importeService = Injector.obtenerServicio(ImporteService.class);
		setCompositionRoot(mainLayout);
		postConstruct();
	}
	
	public void setExpediente(Expediente expediente) {
		this.expediente = expediente;
		postConstruct();
	}
	
	public void postConstruct() {
		//if(expediente!=null && !expediente.esNuevo() && !inicializado){
			cmbBanco.setInputPrompt("Banco Proveniente");
			cmbTipoMoneda.setInputPrompt("Tipo de Moneda");
			cmbTipoCuenta.setInputPrompt("Tipo de Cuenta");
			cmbSituacion.setInputPrompt("Situacion del Dinero");
			
			cmbSituacion.setRequired(true);
			cmbTipoMoneda.setRequired(true);
			
			cmbBanco.setCodigoLista(Constante.LISTA.CODIGO.BANCO);
			cmbBanco.attach();
			cmbTipoCuenta.setCodigoLista(Constante.LISTA.CODIGO.TIPO_CUENTA);
			cmbTipoCuenta.attach();
			cmbTipoMoneda.setCodigoLista(Constante.LISTA.CODIGO.MONEDA);
			cmbTipoMoneda.attach();
			cmbSituacion.setCodigoLista(Constante.LISTA.CODIGO.SITUACION_GENERAL);
			cmbSituacion.attach();
			
			rbAutenticidad.addItem("V");
			rbAutenticidad.addItem("F");
			
			btnRegistrar.addListener((ClickListener) this);
			inicializado=true;
			
			refrescar();
		//}
	}
	
	@Override
	public void buttonClick(ClickEvent event) {
		if(event.getButton().equals(btnRegistrar)) {
			expImporte.setBanco(cmbBanco.getValue() != null ? cmbBanco.getValor() : null);
			expImporte.setMoneda(txtMonto.getValue() != null ? Double.valueOf(txtMonto.getValue().toString()) : null);
			expImporte.setTipoMoneda(cmbTipoMoneda.getValor());
			expImporte.setTipoCuenta(cmbTipoCuenta.getValue() != null ? cmbTipoCuenta.getValor() : null);
			expImporte.setSituacion(cmbSituacion.getValor());
			expImporte.setNroCuenta(txtNroCuenta.getValue() != null ? txtNroCuenta.getValue().toString() : StringUtils.EMPTY);
			expImporte.setNroTarjeta(txtNroTarjeta.getValue() != null ? txtNroTarjeta.getValue().toString() : StringUtils.EMPTY);
			expImporte.setAutenticidad(rbAutenticidad.getValue().toString());
			expImporte.setExpediente(expediente);
			
			if(expImporte.esNuevo()) {
				importeService.crear(expImporte);
			} else {
				importeService.actualizar(expImporte);
			}
			refrescar();
		}
	}
	
	public void refrescar(){
		habilitarEdicion(false);
		limpiar();
		//cargarExpTelefonos(expTelefonoService.buscar(null));
	}
	
	private void habilitarEdicion(boolean flag) {
		if(flag){
			btnRegistrar.setCaption("Actualizar");
		}else{
			btnRegistrar.setCaption("Crear");
		}
	}
	
	private void limpiar() {
		expImporte = new Importe();
		cmbBanco.select(null);
	}	
		
	
	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("-1px");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(true);
		mainLayout.setSpacing(true);
		
		// top-level component properties
		setWidth("-1px");
		setHeight("-1px");
		
		// pnlPrincipal
		pnlPrincipal = buildPnlPrincipal();
		mainLayout.addComponent(pnlPrincipal);
		
		// horizontalLayout_25
		horizontalLayout_25 = buildHorizontalLayout_25();
		mainLayout.addComponent(horizontalLayout_25);
		
		// btnRegistrar
		btnRegistrar = new Button();
		btnRegistrar.setCaption("Registrar");
		btnRegistrar.setImmediate(true);
		btnRegistrar.setWidth("-1px");
		btnRegistrar.setHeight("-1px");
		mainLayout.addComponent(btnRegistrar);
		mainLayout.setComponentAlignment(btnRegistrar, new Alignment(20));
		
		// tblDinero
		tblDinero = new Table();
		tblDinero.setImmediate(false);
		tblDinero.setWidth("900px");
		tblDinero.setHeight("350px");
		mainLayout.addComponent(tblDinero);
		
		return mainLayout;
	}

	@AutoGenerated
	private HorizontalLayout buildPnlPrincipal() {
		// common part: create layout
		pnlPrincipal = new HorizontalLayout();
		pnlPrincipal.setImmediate(false);
		pnlPrincipal.setWidth("-1px");
		pnlPrincipal.setHeight("-1px");
		pnlPrincipal.setMargin(false);
		pnlPrincipal.setSpacing(true);
		
		// cmbTipoMoneda
		cmbTipoMoneda = new ComboBoxLOVS();
		cmbTipoMoneda.setCaption("Tipo de Moneda");
		cmbTipoMoneda.setImmediate(false);
		cmbTipoMoneda.setWidth("150px");
		cmbTipoMoneda.setHeight("-1px");
		pnlPrincipal.addComponent(cmbTipoMoneda);
		
		// txtMonto
		txtMonto = new TextField();
		txtMonto.setCaption("Monto");
		txtMonto.setImmediate(false);
		txtMonto.setWidth("120px");
		txtMonto.setHeight("-1px");
		txtMonto.setRequired(true);
		txtMonto.setInputPrompt("Monto");
		txtMonto.setMaxLength(8);
		pnlPrincipal.addComponent(txtMonto);
		
		// cmbSituacion
		cmbSituacion = new ComboBoxLOVS();
		cmbSituacion.setCaption("Situación");
		cmbSituacion.setImmediate(false);
		cmbSituacion.setWidth("150px");
		cmbSituacion.setHeight("-1px");
		pnlPrincipal.addComponent(cmbSituacion);
		
		// rbAutenticidad
		rbAutenticidad = new OptionGroup();
		rbAutenticidad.setStyleName("horizontal");
		rbAutenticidad.setCaption("Situación del Dinero Incautado");
		rbAutenticidad.setImmediate(false);
		rbAutenticidad.setWidth("300px");
		rbAutenticidad.setHeight("20px");
		rbAutenticidad.setRequired(true);
		pnlPrincipal.addComponent(rbAutenticidad);
		
		return pnlPrincipal;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_25() {
		// common part: create layout
		horizontalLayout_25 = new HorizontalLayout();
		horizontalLayout_25.setImmediate(false);
		horizontalLayout_25.setWidth("-1px");
		horizontalLayout_25.setHeight("-1px");
		horizontalLayout_25.setMargin(false);
		horizontalLayout_25.setSpacing(true);
		
		// cmbTipoCuenta
		cmbTipoCuenta = new ComboBoxLOVS();
		cmbTipoCuenta.setCaption("Tipo de Cuenta");
		cmbTipoCuenta.setImmediate(false);
		cmbTipoCuenta.setWidth("200px");
		cmbTipoCuenta.setHeight("-1px");
		horizontalLayout_25.addComponent(cmbTipoCuenta);
		
		// cmbBanco
		cmbBanco = new ComboBoxLOVS();
		cmbBanco.setCaption("Banco de la Cuenta");
		cmbBanco.setImmediate(false);
		cmbBanco.setWidth("200px");
		cmbBanco.setHeight("-1px");
		horizontalLayout_25.addComponent(cmbBanco);
		
		// txtNroCuenta
		txtNroCuenta = new TextField();
		txtNroCuenta.setCaption("Numero de Cuenta");
		txtNroCuenta.setImmediate(false);
		txtNroCuenta.setWidth("200px");
		txtNroCuenta.setHeight("-1px");
		txtNroCuenta.setInputPrompt("Numero de Cuenta");
		txtNroCuenta.setMaxLength(20);
		horizontalLayout_25.addComponent(txtNroCuenta);
		
		// txtNroTarjeta
		txtNroTarjeta = new TextField();
		txtNroTarjeta.setCaption("Numero de Tarjeta");
		txtNroTarjeta.setImmediate(false);
		txtNroTarjeta.setWidth("200px");
		txtNroTarjeta.setHeight("-1px");
		txtNroTarjeta.setInputPrompt("Numero de Tarjeta");
		txtNroTarjeta.setMaxLength(24);
		horizontalLayout_25.addComponent(txtNroTarjeta);
		
		return horizontalLayout_25;
	}

}
