package pe.gob.mininter.dirandro.vaadin.panel.util;


import java.math.BigDecimal;
import java.util.Date;

import org.springframework.transaction.annotation.Transactional;

import pe.gob.mininter.dirandro.model.Organizacion;
import pe.gob.mininter.dirandro.service.OrganizacionService;
import pe.gob.mininter.dirandro.vaadin.panel.busqueda.PanelBuscarOrganizacion;
import pe.gob.mininter.dirandro.vaadin.util.Injector;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.TextField;
import com.vaadin.ui.VerticalLayout;


public class PanelAgregarOrganizacion extends CustomComponent implements ClickListener{

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private VerticalLayout pnlPrincipal;
	@AutoGenerated
	private HorizontalLayout pnl5;
	@AutoGenerated
	private Button btnCancelar;
	@AutoGenerated
	private Button btnGrabar;
	@AutoGenerated
	private HorizontalLayout pnl2;
	@AutoGenerated
	private TextField txtUbicacionActivos;
	@AutoGenerated
	private TextField txtZonaOperacion;
	@AutoGenerated
	private TextField txtNroIntegrantes;
	@AutoGenerated
	private HorizontalLayout pnl1_1;
	@AutoGenerated
	private TextField txtDescripcion;
	@AutoGenerated
	private HorizontalLayout pnl1;
	@AutoGenerated
	private TextField txtNombre;
	private static final long serialVersionUID = 4354750785128082366L;
	
	private Organizacion organizacion;
	private OrganizacionService organizacionService;
	
	private PanelBuscarOrganizacion pnlBuscarOrganizacion=null;
	
	public PanelAgregarOrganizacion(PanelBuscarOrganizacion pnlBuscarOrganizacion, Organizacion organizacion) {
		this.pnlBuscarOrganizacion = pnlBuscarOrganizacion;
		buildMainLayout();
		setCompositionRoot(mainLayout);
		
		organizacionService = Injector.obtenerServicio(OrganizacionService.class);
		
		postConstruct();
	}
	
	
	
	public void postConstruct() {
		
		btnGrabar.addListener((ClickListener)this);
		btnCancelar.addListener((ClickListener)this);
	}
		
	
	@Override
	public void buttonClick(ClickEvent event) {
		if (event.getButton().equals(btnGrabar)) {
			 registrarOrganizacion();
			 
//			 if(pnlBuscarOrganizacion != null)
//			 {
//				 pnlBuscarOrganizacion.setOrganizacionPopup(organizacion);
//				 pnlBuscarOrganizacion.refrescarLista();
//			 }
			 			 
			 getApplication().getMainWindow().removeWindow(getWindow());
		}
		else if (event.getButton().equals(btnCancelar)) {
			 getApplication().getMainWindow().removeWindow(getWindow());
		}
	}	
	
	@Transactional
	private void registrarOrganizacion(){
		
		String nroI = (this.txtNroIntegrantes.getValue().toString().length() == 0) ? "0" : this.txtNroIntegrantes.getValue().toString();
		
		organizacion = new Organizacion();
		organizacion.setNombre(txtNombre.getValue().toString());
		organizacion.setNroIntegrantes(new BigDecimal(nroI));
		organizacion.setDescripcion(this.txtDescripcion.getValue().toString());
		organizacion.setZonaOperacion(txtZonaOperacion.getValue().toString());
		organizacion.setUbicacionActivos(this.txtUbicacionActivos.getValue().toString());
		organizacion.setCreacion(new Date());
		organizacionService.crear(organizacion);
		organizacion = organizacionService.obtener(organizacion.getId());
	}
	
	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("600px");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(false);
		
		// top-level component properties
		setWidth("600px");
		setHeight("-1px");
		
		// pnlPrincipal
		pnlPrincipal = buildPnlPrincipal();
		mainLayout.addComponent(pnlPrincipal);
		mainLayout.setComponentAlignment(pnlPrincipal, new Alignment(20));
		
		return mainLayout;
	}



	@AutoGenerated
	private VerticalLayout buildPnlPrincipal() {
		// common part: create layout
		pnlPrincipal = new VerticalLayout();
		pnlPrincipal.setCaption("Nueva Organización");
		pnlPrincipal.setImmediate(false);
		pnlPrincipal.setWidth("-1px");
		pnlPrincipal.setHeight("-1px");
		pnlPrincipal.setMargin(true);
		pnlPrincipal.setSpacing(true);
		
		// pnl1
		pnl1 = buildPnl1();
		pnlPrincipal.addComponent(pnl1);
		
		// pnl1_1
		pnl1_1 = buildPnl1_1();
		pnlPrincipal.addComponent(pnl1_1);
		
		// pnl2
		pnl2 = buildPnl2();
		pnlPrincipal.addComponent(pnl2);
		
		// pnl5
		pnl5 = buildPnl5();
		pnlPrincipal.addComponent(pnl5);
		pnlPrincipal.setComponentAlignment(pnl5, new Alignment(20));
		
		return pnlPrincipal;
	}



	@AutoGenerated
	private HorizontalLayout buildPnl1() {
		// common part: create layout
		pnl1 = new HorizontalLayout();
		pnl1.setImmediate(false);
		pnl1.setWidth("-1px");
		pnl1.setHeight("-1px");
		pnl1.setMargin(false);
		pnl1.setSpacing(true);
		
		// txtNombre
		txtNombre = new TextField();
		txtNombre.setCaption("Nombre Organización");
		txtNombre.setImmediate(false);
		txtNombre.setWidth("401px");
		txtNombre.setHeight("-1px");
		txtNombre.setRequired(true);
		pnl1.addComponent(txtNombre);
		
		return pnl1;
	}



	@AutoGenerated
	private HorizontalLayout buildPnl1_1() {
		// common part: create layout
		pnl1_1 = new HorizontalLayout();
		pnl1_1.setImmediate(false);
		pnl1_1.setWidth("-1px");
		pnl1_1.setHeight("-1px");
		pnl1_1.setMargin(false);
		pnl1_1.setSpacing(true);
		
		// txtDescripcion
		txtDescripcion = new TextField();
		txtDescripcion.setCaption("Descripción");
		txtDescripcion.setImmediate(false);
		txtDescripcion.setWidth("401px");
		txtDescripcion.setHeight("-1px");
		pnl1_1.addComponent(txtDescripcion);
		
		return pnl1_1;
	}



	@AutoGenerated
	private HorizontalLayout buildPnl2() {
		// common part: create layout
		pnl2 = new HorizontalLayout();
		pnl2.setImmediate(false);
		pnl2.setWidth("-1px");
		pnl2.setHeight("-1px");
		pnl2.setMargin(false);
		pnl2.setSpacing(true);
		
		// txtNroIntegrantes
		txtNroIntegrantes = new TextField();
		txtNroIntegrantes.setCaption("# Integrantes");
		txtNroIntegrantes.setImmediate(false);
		txtNroIntegrantes.setWidth("-1px");
		txtNroIntegrantes.setHeight("-1px");
		pnl2.addComponent(txtNroIntegrantes);
		
		// txtZonaOperacion
		txtZonaOperacion = new TextField();
		txtZonaOperacion.setCaption("Zona de Operación");
		txtZonaOperacion.setImmediate(false);
		txtZonaOperacion.setWidth("-1px");
		txtZonaOperacion.setHeight("-1px");
		txtZonaOperacion.setRequired(true);
		pnl2.addComponent(txtZonaOperacion);
		
		// txtUbicacionActivos
		txtUbicacionActivos = new TextField();
		txtUbicacionActivos.setCaption("Ubicación Activos");
		txtUbicacionActivos.setImmediate(false);
		txtUbicacionActivos.setWidth("117px");
		txtUbicacionActivos.setHeight("-1px");
		pnl2.addComponent(txtUbicacionActivos);
		
		return pnl2;
	}



	@AutoGenerated
	private HorizontalLayout buildPnl5() {
		// common part: create layout
		pnl5 = new HorizontalLayout();
		pnl5.setImmediate(false);
		pnl5.setWidth("-1px");
		pnl5.setHeight("-1px");
		pnl5.setMargin(false);
		pnl5.setSpacing(true);
		
		// btnGrabar
		btnGrabar = new Button();
		btnGrabar.setCaption("Grabar");
		btnGrabar.setImmediate(true);
		btnGrabar.setWidth("80px");
		btnGrabar.setHeight("-1px");
		pnl5.addComponent(btnGrabar);
		
		// btnCancelar
		btnCancelar = new Button();
		btnCancelar.setCaption("Cancelar");
		btnCancelar.setImmediate(true);
		btnCancelar.setWidth("80px");
		btnCancelar.setHeight("-1px");
		pnl5.addComponent(btnCancelar);
		
		return pnl5;
	}
}
